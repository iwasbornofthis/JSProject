<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>테스트</title>
  <!-- <script src="data.js"></script> -->
  <style>
    .correct-answer {
      color: red;
    }

    .wrong-answer {
      color: green;
    }

    .normal-answer {
      color: black;
    }

    .hidden {
      display: none;
    }

    .show {
      display: block;
    }

    @keyframes slideIn {
      from {
        transform: translateX(-100%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .slide-in-text {
      opacity: 0;
      animation: slideIn 1s forwards;
      /* forwards 키워드는 애니메이션이 끝난 상태를 유지합니다 */
      animation-delay: 0.5s;
      /* 애니메이션 시작 전 대기 시간 */
    }
  </style>
</head>

<body>
  <h1>자동차 구조 입문 테스트</h1>
  <form id="cbtForm">
    <div id="question-container"></div>
    <input type="submit" value="제출">
  </form>
  <div id="results-container" class="slide-in-text hidden"></div> <!-- 결과 표시를 위한 컨테이너 추가 -->
  <button id="review-wrong-answers" class="hidden" onclick="displayWrongAnswers()">오답노트 보기</button> <!-- 처음에는 숨겨진 버튼 -->
  <div id="wrong-note-container" class="hidden">
    <h2>오답노트</h2>
    <!-- 오답노트의 내용이 여기에 들어갑니다. -->
  </div>
  <script>
    const quiz = {
      1: {
        question: "자동차 산업과 배경에서 가장 적합하지 않는 설명을 고르십시오.",
        choices: {
          choice1: "화석 연료 사용에 따른 배기 배출물을 저감해야 한다.",
          choice2: "화석 연료 사용량은 여전히 높은 수준이다.",
          choice3: "CO2는 안정적인 물질로 전혀 문제가 되지 않는다.",
          choice4: "탄소 중립화은 화석 연료 사용과 중요한 연관성이 있다."
        },
        correctChoice: "choice3"
      },
      2: {
        question: "다음 중 엔진룸 내부 장치에 대해 올바르게 설명한 것을 고르십시오.",
        choices: {
          choice1: "엔진 열을 시켜주는 오일은 브레이크 오일이다.",
          choice2: "엔진 오일은 워셔액 탱크로 주입을 하는 것이 일반적이다.",
          choice3: "자동차를 멈추는 것은 에어 클리너의 가장 중요한 역할이다.",
          choice4: "에어 클리너는 자동차 주행 시 엔진으로 들어오는 공기의 이물질을 거를 수 있다."
        },
        correctChoice: "choice4"
      },


    };
    const cbtForm = document.getElementById('cbtForm');
    const questionContainer = document.getElementById('question-container');

    let currentQuestionIndex = 0;
    let answeredQuestions = {};

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function displayQuestion(questionIndex) {
      const currentQuestion = quiz[questionIndex];
      if (currentQuestion) {
        const shuffledChoices = shuffleArray(Object.entries(currentQuestion.choices));

        questionContainer.innerHTML = `<p>${currentQuestion.question}</p>`;

        shuffledChoices.forEach(([key, value]) => {
          questionContainer.innerHTML += `
                <input type="radio" name="answer" value="${key}">${value}<br>
            `;
        });
      }
    }
    function displayRandomQuestion() {
      const questionIndexes = Object.keys(quiz);
      const unansweredQuestions = questionIndexes.filter(q => !answeredQuestions[q]);

      if (unansweredQuestions.length !== 0) {
        currentQuestionIndex = unansweredQuestions[Math.floor(Math.random() * unansweredQuestions.length)];
        displayQuestion(currentQuestionIndex);
      } else {
        const answeredCount = Object.keys(answeredQuestions).length;
        questionContainer.innerHTML = `
            <p>모든 문제를 완료하였습니다. 감사합니다!</p>
            <p>총 ${answeredCount}개의 문제를 풀었습니다.</p>
            <button onclick="restartQuiz()">다시 시작</button>
        `;
      }
    }

    function restartQuiz() {
      answeredQuestions = {};
      displayRandomQuestion();
    }

    displayRandomQuestion();
    let wrongAnswers = {};

    function displayWrongAnswers() {
      const wrongNoteContainer = document.getElementById('wrong-note-container');
      wrongNoteContainer.innerHTML = '<h2>오답노트</h2>'; // 내용을 초기화하고 제목을 설정합니다.

      Object.keys(wrongAnswers).forEach(questionIndex => {
        const question = quiz[questionIndex];
        wrongNoteContainer.innerHTML += `<p><strong>문제: </strong>${question.question}</p>`;
        Object.keys(question.choices).forEach(choiceKey => {
          const choiceValue = question.choices[choiceKey];
          const isCorrect = choiceKey === question.correctChoice;
          const isWrong = choiceKey === wrongAnswers[questionIndex];

          // 정답과 오답에 대한 스타일링을 적용합니다.
          const labelClass = isCorrect ? 'correct-answer' :
            isWrong ? 'wrong-answer' : 'normal-answer';
          wrongNoteContainer.innerHTML += `<label class="${labelClass}">${choiceValue}</label><br>`;
        });
      });

      wrongNoteContainer.style.display = 'block'; // 오답 노트를 표시합니다.
    }
    function handleAnswer(selectedAnswer, currentQuestion) {
      if (selectedAnswer.value === currentQuestion.correctChoice) {
        answeredQuestions[currentQuestionIndex] = 'correct';
      } else {
        answeredQuestions[currentQuestionIndex] = 'wrong';
        wrongAnswers[currentQuestionIndex] = selectedAnswer.value;
      }
    }

    cbtForm.addEventListener('submit', function (event) {
      event.preventDefault();
      const selectedAnswer = document.querySelector('input[name="answer"]:checked');
      if (selectedAnswer) {
        const currentQuestion = quiz[currentQuestionIndex];
        handleAnswer(selectedAnswer, currentQuestion);
        const allQuestionsAnswered = Object.keys(quiz).length === Object.keys(answeredQuestions).length;
        if (allQuestionsAnswered) {
          // 모든 문제를 풀었다면 결과를 계산하고 표시합니다.
          calculateAndShowResults();
        } else {
          // 아직 풀지 않은 문제가 있다면 다음 문제를 표시합니다.
          displayRandomQuestion();
        }
      } else {
        alert('답변을 선택해 주세요.');
      }
    });

    function calculateAndShowResults() {
      const resultsContainer = document.getElementById('results-container');
      const wrongNoteButton = document.getElementById('review-wrong-answers');
      const totalQuestions = Object.keys(quiz).length;
      const wrongCount = Object.values(answeredQuestions).filter(val => val === 'wrong').length;

      resultsContainer.innerHTML = `<p>총 ${totalQuestions}문제 중 ${wrongCount}문제를 틀렸습니다.</p>`;
      resultsContainer.classList.remove('hidden');
      resultsContainer.classList.add('slide-in-text');

      if (wrongCount > 0) {
        wrongNoteButton.classList.remove('hidden');
        wrongNoteButton.classList.add('slide-in-text');
      }
    }
    function restartQuiz() {
      answeredQuestions = {};
      wrongAnswers = {};
      const wrongNoteContainer = document.getElementById('wrong-note-container');
      wrongNoteContainer.style.display = 'none'; // 오답노트 컨테이너를 숨깁니다.
      displayRandomQuestion();
    }
  </script>
</body>

</html>